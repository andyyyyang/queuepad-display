<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <title>Settings</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif; 
      background: #fafafa;
      min-height: 100vh;
      padding: 0 20px 20px 40px; /* ç§»é™¤é ‚éƒ¨ paddingï¼Œä¿ç•™å·¦å³å’Œåº•éƒ¨ */
      color: #1a1a1a;
      line-height: 1.5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .login-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      margin-bottom: 30px;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .login-container h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
      color: #1a1a1a;
    }
    
    .login-form {
      display: flex;
      gap: 16px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .login-form input[type="password"] {
      padding: 12px 16px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      transition: all 0.2s;
      min-width: 250px;
      background: #ffffff;
    }
    
    .login-form input[type="password"]:focus {
      border-color: #007aff;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .login-form button {
      padding: 10px 20px;
      background: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .login-form button:hover {
      background: #0056d6;
      transform: translateY(-1px);
    }
    
    .main-content {
      display: none;
    }
    
    .main-content.show {
      display: block;
    }
    
    .logout-btn {
      padding: 8px 16px;
      background: #ff3b30;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .logout-btn:hover {
      background: #d70015;
      transform: translateY(-1px);
    }

    /* æ¼‚æµ®åº•éƒ¨å°èˆªæ¬„ */
    .floating-nav {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .nav-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px 16px;
      background: transparent;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      gap: 4px;
      min-width: 80px;
      position: relative;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .nav-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .nav-button:hover::before {
      opacity: 0.1;
    }

    .floating-nav .nav-button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
      color: white !important;
    }

    .floating-nav .nav-button.active::before {
      display: none !important;
    }

 
    .nav-button:active {
      transform: translateY(0);
      transition: transform 0.1s ease;
    }

    /* å°èˆªåœ–æ¨™å’Œæ¨™ç±¤æ¨£å¼ */
    .nav-icon {
      font-size: 24px;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
      text-align: center;
      line-height: 1.2;
    }


    .floating-nav .nav-button.active .nav-label {
      color: white !important;
      font-weight: 700 !important;
    }

    .nav-button:hover .nav-icon {
      transform: scale(1.05);
    }

    /* è§¸æ§è¨­å‚™å„ªåŒ– */
    @media (hover: none) and (pointer: coarse) {
      .nav-button {
        min-height: 44px;
        -webkit-tap-highlight-color: transparent;
      }
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ¼‚æµ®å°èˆª */
    @media (max-width: 768px) {
      .floating-nav {
        bottom: 15px;
        padding: 6px;
        gap: 6px;
      }
      
      .nav-button {
        padding: 10px 14px;
        min-width: 70px;
        min-height: 44px; /* è§¸æ§å„ªåŒ– */
      }
      
      .nav-icon {
        font-size: 22px;
      }
      
      .nav-label {
        font-size: 10px;
      }
    }

    @media (max-width: 480px) {
      .floating-nav {
        bottom: 10px;
        padding: 5px;
        gap: 4px;
      }
      
      .nav-button {
        padding: 8px 12px;
        min-width: 60px;
        min-height: 44px; /* è§¸æ§å„ªåŒ– */
      }
      
      .nav-icon {
        font-size: 20px;
      }
      
      .nav-label {
        font-size: 9px;
      }
    }

    /* é ç±¤å…§å®¹å‹•ç•« */
    .tab-content {
      display: none;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tab-content.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .tab-content.active {
      display: block;
    }
    
    .settings-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
    }

    /* ç§»é™¤ç¬¬ä¸€å€‹è¨­å®šå¡ç‰‡çš„é ‚éƒ¨ç•™ç™½ */
    .tab-content:first-child .settings-card:first-child {
      margin-top: 0;
    }

    /* ç§»é™¤ç¬¬ä¸€å€‹é ç±¤å…§å®¹çš„é ‚éƒ¨ç•™ç™½ */
    .tab-content:first-child {
      margin-top: 0;
      padding-top: 0;
    }
    
    .settings-card h2 {
      color: #1a1a1a;
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .setting-item:last-child {
      border-bottom: none;
    }
    
    .setting-item span {
      color: #333;
      font-weight: 500;
    }
    
    .setting-item button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .toggle-on {
      background: #34c759;
      color: white;
    }
    
    .toggle-off {
      background: #ff3b30;
      color: white;
    }
    
    .toggle-on:hover, .toggle-off:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }
    
    .form-group input[type="text"],
    .form-group input[type="number"] {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
      background: #ffffff;
    }
    
    .form-group input[type="text"]:focus,
    .form-group input[type="number"]:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.1);
    }
    
    .form-group input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 1px dashed #d1d1d1;
      border-radius: 6px;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .form-group input[type="file"]:hover {
      border-color: #007aff;
      background: #f0f8ff;
    }
    
    .save-btn {
      width: 100%;
      padding: 12px;
      background: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .save-btn:hover {
      background: #0056d6;
      transform: translateY(-1px);
    }

    .save-btn.saved {
      background: #34c759 !important;
      color: white !important;
      cursor: not-allowed;
    }

    .save-btn.saved:hover {
      background: #34c759 !important;
      transform: none;
    }

    .utility-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    .utility-btn {
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .utility-btn.clear {
      background: #ff9500;
      color: white;
    }

    .utility-btn.test {
      background: #34c759;
      color: white;
    }

    .utility-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .utility-btn.clear:hover {
      background: #e6850e;
    }

    .utility-btn.test:hover {
      background: #2fb350;
    }
    
    .ads-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .ads-section h2 {
      color: #1a1a1a;
      margin-bottom: 24px;
      font-size: 20px;
      font-weight: 600;
    }
    
    .upload-area {
      background: #f8f9fa;
      border: 1px dashed #d1d1d1;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: center;
      transition: all 0.2s;
    }
    
    .upload-area:hover {
      background: #f0f8ff;
      border-color: #007aff;
    }
    
    .upload-area h3 {
      color: #007aff;
      margin-bottom: 8px;
      font-size: 16px;
      font-weight: 600;
    }
    
    .upload-area p {
      color: #666;
      margin-bottom: 16px;
      font-size: 13px;
    }
    
    .upload-form {
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .upload-form input[type="file"] {
      padding: 10px;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      min-width: 300px;
    }
    
    .upload-form button {
      padding: 10px 20px;
      background: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .upload-form button:hover {
      background: #0056d6;
      transform: translateY(-1px);
    }
    
    .ad-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s;
      border: 1px solid #f0f0f0;
    }
    
    .ad-item:hover {
      background: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .ad-info {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
    }
    
    .ad-info video {
      height: 60px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .ad-filename {
      font-weight: 500;
      color: #1a1a1a;
      font-size: 16px;
    }
    
    .ad-controls {
      display: flex;
      gap: 6px;
    }
    
    .control-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
    }
    
    .control-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .move-up { background: #007aff; color: white; }
    .move-down { background: #34c759; color: white; }
    .delete { background: #ff3b30; color: white; }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .empty-state p {
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .empty-state small {
      font-size: 14px;
      opacity: 0.7;
    }

    /* æ‰‹æ©Ÿé©é…æ¨£å¼ */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      .container {
        max-width: 100%;
      }
      
      .login-container {
        padding: 24px 20px;
        margin-bottom: 20px;
      }
      
      .login-container h2 {
        font-size: 20px;
        margin-bottom: 20px;
      }
      
      .login-form {
        flex-direction: column;
        gap: 12px;
      }
      
      .login-form input[type="password"] {
        min-width: auto;
        width: 100%;
        max-width: 280px;
      }
      
      .header {
        padding: 16px 10px;
        margin-bottom: 12px;
      }

      .header-top {
        flex-direction: column;
        gap: 16px;
        margin-bottom: 16px;
      }

      .header-title {
        order: 1;
      }
        
      .header h1 {
        font-size: 20px;
        margin-bottom: 6px;
      }
        
      .header p {
        font-size: 14px;
      }

      .logout-btn {
        order: 2;
        width: 100%;
        justify-content: center;
        padding: 10px;
        font-size: 14px;
      }

      .toolbar {
        order: 3;
        margin-top: 8px;
      }

      .toolbar-button {
        padding: 8px 10px;
        font-size: 12px;
      }
      
      .settings-card {
        padding: 20px;
        margin-bottom: 20px;
      }
      
      .settings-card h2 {
        font-size: 18px;
        margin-bottom: 16px;
      }
      
      .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        padding: 12px 0;
      }
      
      .setting-item button {
        width: 100%;
        padding: 10px;
        font-size: 14px;
      }
      
      .ads-section {
        padding: 20px;
      }
      
      .ads-section h2 {
        font-size: 18px;
        margin-bottom: 20px;
      }
      
      .upload-area {
        padding: 16px;
        margin-bottom: 20px;
      }
      
      .upload-area h3 {
        font-size: 15px;
        margin-bottom: 8px;
      }
      
      .upload-area p {
        font-size: 12px;
        margin-bottom: 16px;
      }
      
      .upload-form {
        flex-direction: column;
        gap: 12px;
      }
      
      .upload-form input[type="file"] {
        min-width: auto;
        width: 100%;
      }
      
      .upload-form button {
        width: 100%;
        padding: 14px;
        font-size: 14px;
      }
      
      .ad-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
        padding: 16px;
      }
      
      .ad-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        width: 100%;
      }
      
      .ad-info video {
        width: 100%;
        height: auto;
        max-height: 120px;
        object-fit: cover;
      }
      
      .ad-filename {
        font-size: 14px;
        word-break: break-all;
      }
      
      .ad-controls {
        width: 100%;
        justify-content: space-between;
        gap: 6px;
      }
      
      .control-btn {
        flex: 1;
        padding: 10px 8px;
        font-size: 11px;
        justify-content: center;
        min-height: 44px;
      }

      .utility-buttons {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .utility-btn {
        padding: 14px;
        font-size: 14px;
      }
      
      .empty-state {
        padding: 32px 20px;
      }
      
      .empty-state p {
        font-size: 16px;
      }
      
      .empty-state small {
        font-size: 14px;
      }
    }

    /* å°æ‰‹æ©Ÿé©é… */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      .login-container,
      .header,
      .settings-card,
      .ads-section {
        border-radius: 12px;
      }
      
      .login-container h2 {
        font-size: 18px;
      }
      
      .header h1 {
        font-size: 18px;
      }
      
      .header p {
        font-size: 12px;
      }
      
      .settings-card h2,
      .ads-section h2 {
        font-size: 16px;
      }
      
      .upload-area h3 {
        font-size: 14px;
      }
      
      .control-btn {
        font-size: 10px;
        padding: 8px 6px;
      }

      .toolbar-button {
        padding: 6px 8px;
        font-size: 11px;
      }
    }

    /* è§¸æ§å„ªåŒ– */
    @media (hover: none) and (pointer: coarse) {
      .control-btn,
      .utility-btn,
      .setting-item button,
      .upload-form button,
      .save-btn,
      .toolbar-button,
      .logout-btn {
        min-height: 44px;
        -webkit-tap-highlight-color: transparent;
      }
      
      .control-btn:active,
      .utility-btn:active,
      .setting-item button:active,
      .upload-form button:active,
      .save-btn:active,
      .toolbar-button:active,
      .logout-btn:active {
        transform: scale(0.98);
        transition: transform 0.1s;
      }
      
      .ad-item:hover {
        transform: none;
      }
      
      .control-btn:hover,
      .utility-btn:hover,
      .setting-item button:hover,
      .upload-form button:hover,
      .save-btn:hover,
      .toolbar-button:hover,
      .logout-btn:hover {
        transform: none;
      }
    }

    /* æ©«å‘æ‰‹æ©Ÿé©é… */
    @media (max-width: 768px) and (orientation: landscape) {
      .header-top {
        flex-direction: row;
        align-items: center;
        gap: 20px;
      }

      .header-title {
        flex: 1;
        text-align: left;
      }

      .logout-btn {
        width: auto;
        order: 3;
      }

      .toolbar {
        order: 4;
        margin-top: 0;
        flex: 1;
      }
      
      .settings-card {
        margin-bottom: 16px;
      }
      
      .ad-item {
        flex-direction: row;
        align-items: center;
      }
      
      .ad-info {
        flex-direction: row;
        align-items: center;
        flex: 1;
      }
      
      .ad-info video {
        width: auto;
        height: 60px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ç™»å…¥å€å¡Š -->
    <div class="login-container" id="loginContainer">
      <h2>ğŸ” ç®¡ç†å“¡ç™»å…¥</h2>
      <form class="login-form" id="loginForm">
        <input type="password" id="passwordInput" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼" required>
        <button type="submit">ç™»å…¥</button>
  </form>
    </div>

    <!-- ä¸»è¦å…§å®¹å€å¡Š -->
    <div class="main-content" id="mainContent">
      <!-- é é¢æ¨™é¡Œå’Œ Toolbar -->
      <div class="header">
        
        <!-- æ¼‚æµ®åº•éƒ¨å°èˆªæ¬„ -->
        <div class="floating-nav">
          <button class="nav-button active" onclick="showTab('ads', event)">
            <span class="nav-icon">ğŸ“º</span>
            <span class="nav-label">å»£å‘Šç®¡ç†</span>
          </button>
          <button class="nav-button" onclick="showTab('general', event)">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-label">åŸºæœ¬è¨­å®š</span>
          </button>
          <button class="nav-button" onclick="showTab('print', event)">
            <span class="nav-icon">ğŸ–¨ï¸</span>
            <span class="nav-label">åˆ—å°è¨­å®š</span>
          </button>
        </div>
      </div>

      <!-- åŸºæœ¬è¨­å®šåˆ†é  -->
      <div id="general" class="tab-content">
        <div class="settings-card">
          <h2>âš™ï¸ åŸºæœ¬è¨­å®š</h2>
          <div class="form-group">
            <label>ä¼ºæœå™¨ç¶²å€</label>
            <div style="display: flex; gap: 12px; align-items: flex-end;">
              <input type="text" id="serverUrlInput" value="{{ server_url }}" 
                     placeholder="ä¾‹å¦‚ï¼šhttps://example.com/status" style="flex: 1;">
              <button type="button" class="save-btn" style="width: auto; padding: 10px 20px;" 
                      onclick="saveServerUrl()">
                ğŸ’¾ ä¿å­˜
              </button>
            </div>
            <p style="margin-top: 4px; font-size: 12px; color: #86868b;">
              âš ï¸ ä¿®æ”¹å¾Œéœ€è¦é‡æ–°å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼æ‰èƒ½ç”Ÿæ•ˆ
            </p>
          </div>
          
          <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #f0f0f0;">
            <h3 style="margin-bottom: 16px; color: #333; font-size: 16px;">å¿«é€Ÿæ“ä½œ</h3>
            <div class="setting-item">
              <span>å½±ç‰‡éŸ³æ•ˆ</span>
              <button class="{% if get_muted %}toggle-off{% else %}toggle-on{% endif %}" 
                      onclick="toggleMute()">
                {% if get_muted %}ğŸ”‡ å·²éœéŸ³{% else %}ğŸ”Š å·²é–‹å•Ÿ{% endif %}
              </button>
            </div>
            <div class="setting-item">
              <span>èªéŸ³æ’­å ±</span>
              <button class="{% if voice_enabled %}toggle-on{% else %}toggle-off{% endif %}" 
                      onclick="toggleVoice()">
                {% if voice_enabled %}ğŸ”Š å·²é–‹å•Ÿ{% else %}ğŸ”‡ å·²é—œé–‰{% endif %}
              </button>
            </div>
            <div class="setting-item">
              <span>é¡¯ç¤ºç•«é¢</span>
              <button class="toggle-on" onclick="refreshDisplay()">ğŸ”„ é‡æ–°æ•´ç†</button>
            </div>
            <div class="setting-item">
              <span>é—œé–‰ç€è¦½å™¨</span>
              <button class="toggle-off" onclick="closeChromium()">âŒ é—œé–‰ Chromium</button>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ—å°è¨­å®šåˆ†é  -->
      <div id="print" class="tab-content">
        <div class="settings-card">
          <h2>ğŸ–¨ï¸ åˆ—å°è¨­å®š</h2>
          
          <div class="form-group">
            <label>QR Code ç¶²å€æ¨¡æ¿</label>
            <div style="display: flex; gap: 12px; align-items: flex-end;">
              <input type="text" id="qrUrlInput" value="{{ qr_url }}" 
                     placeholder="å¯ç”¨ {number}, {waiting} è®Šæ•¸" style="flex: 1;">
              <button type="button" class="save-btn" style="width: auto; padding: 10px 20px;" 
                      onclick="saveQrUrl()">
                ğŸ’¾ ä¿å­˜
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label>å°è¡¨æ©Ÿ IP ä½å€</label>
            <div style="display: flex; gap: 12px; align-items: flex-end;">
              <input type="text" id="printerIpInput" value="{{ printer_ip }}" 
                     placeholder="ä¾‹å¦‚ï¼š192.168.0.151" style="flex: 1;">
              <button type="button" class="save-btn" style="width: auto; padding: 10px 20px;" 
                      onclick="savePrinterIp()">
                ğŸ’¾ ä¿å­˜
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label>é è¨­åˆ—å°å¼µæ•¸</label>
            <div style="display: flex; gap: 12px; align-items: flex-end;">
              <input type="number" id="printCountInput" value="{{ print_count }}" 
                     min="1" max="10" step="1" style="flex: 1;">
              <button type="button" class="save-btn" style="width: auto; padding: 10px 20px;" 
                      onclick="savePrintCount()">
                ğŸ’¾ ä¿å­˜
              </button>
            </div>
            <p style="margin-top: 4px; font-size: 12px; color: #86868b;">
              ğŸ’¡ è¨­å®šç¯„åœï¼š1-10 å¼µï¼Œæ¯æ¬¡åˆ—å°è™Ÿç¢¼æ™‚æœƒè‡ªå‹•åˆ—å°æŒ‡å®šå¼µæ•¸
    </p>
  </div>

          <div class="form-group">
            <label>ç¥¨é¢èƒŒæ™¯åœ–ç‰‡</label>
            <div style="display: flex; gap: 12px; align-items: flex-end;">
              <input type="file" id="printBgInput" accept="image/*" style="flex: 1;">
              <button type="button" class="save-btn" style="width: auto; padding: 10px 20px;" 
                      onclick="savePrintBg()">
                ğŸ’¾ ä¸Šå‚³
              </button>
  </div>
            <p style="margin-top: 8px; font-size: 13px; color: #86868b;">
              {% if has_print_bg %}âœ… å·²ä¸Šå‚³èƒŒæ™¯åœ–ç‰‡{% else %}âŒ æœªä¸Šå‚³èƒŒæ™¯åœ–ç‰‡{% endif %}
            </p>
          </div>

          <!-- å·¥å…·æŒ‰éˆ• -->
          <div class="utility-buttons">
            <a href="/ads/clear_cache?pw=yellowgirl" class="utility-btn clear" 
               onclick="return confirm('ç¢ºå®šè¦æ¸…ç©ºåˆ—å°è¨˜éŒ„èˆ‡æš«å­˜å—ï¼Ÿ')">
      ğŸ§¹ æ¸…ç©ºåˆ—å°è¨˜éŒ„èˆ‡æš«å­˜
    </a>
            <a href="#" class="utility-btn test" onclick="testPrint()">
              ğŸ–¨ï¸ æ¸¬è©¦åˆ—å°
            </a>
          </div>
        </div>
      </div>

      <!-- å»£å‘Šç®¡ç†åˆ†é  -->
      <div id="ads" class="tab-content active">
        <div class="ads-section">
          <h2>ğŸ“º å»£å‘Šç®¡ç†</h2>
          
          <!-- ä¸Šå‚³å€åŸŸ -->
          <div class="upload-area">
            <h3>ğŸ“¤ ä¸Šå‚³æ–°å»£å‘Š</h3>
            <p>æ”¯æ´ MP4 æ ¼å¼ï¼Œæª”æ¡ˆæœƒè‡ªå‹•åŠ å…¥æ’­æ”¾æ¸…å–®</p>
            <form class="upload-form" method="post" enctype="multipart/form-data">
              <input type="file" name="file" accept="video/mp4" required>
              <button type="submit">ä¸Šå‚³å½±ç‰‡</button>
            </form>
          </div>

          <!-- å»£å‘Šåˆ—è¡¨ -->
          <h3 style="margin-bottom: 16px; color: #333; font-size: 16px;">ç›®å‰å»£å‘Šåˆ—è¡¨</h3>
          {% if files %}
  {% for f in files %}
              <div class="ad-item">
                <div class="ad-info">
        <video src="/static/ads/{{f}}" controls></video>
                  <span class="ad-filename">{{f}}</span>
      </div>
                <div class="ad-controls">
                  <a href="/ads/move/{{f}}/up?pw=yellowgirl" class="control-btn move-up">â¬†ï¸ ä¸Šç§»</a>
                  <a href="/ads/move/{{f}}/down?pw=yellowgirl" class="control-btn move-down">â¬‡ï¸ ä¸‹ç§»</a>
                  <a href="/ads/delete/{{f}}?pw=yellowgirl" class="control-btn delete" 
                     onclick="return confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å»£å‘Šå—ï¼Ÿ')">ğŸ—‘ï¸ åˆªé™¤</a>
      </div>
    </div>
  {% endfor %}
          {% else %}
            <div class="empty-state">
              <p>ç›®å‰æ²’æœ‰å»£å‘Šå½±ç‰‡</p>
              <small>è«‹ä½¿ç”¨ä¸Šæ–¹ä¸Šå‚³åŠŸèƒ½æ–°å¢å»£å‘Š</small>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

<script>
    // åˆ†é åˆ‡æ›åŠŸèƒ½
    function showTab(tabName, event) {
      console.log('showTab called with:', tabName, event);
      
      // éš±è—æ‰€æœ‰åˆ†é å…§å®¹
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // ç§»é™¤æ‰€æœ‰åˆ†é æŒ‰éˆ•çš„ active ç‹€æ…‹
      const tabButtons = document.querySelectorAll('.nav-button');
      tabButtons.forEach(button => {
        button.classList.remove('active');
        console.log('Removed active from button:', button);
      });
      
      // é¡¯ç¤ºé¸ä¸­çš„åˆ†é å…§å®¹
      const targetContent = document.getElementById(tabName);
      if (targetContent) {
        targetContent.classList.add('active');
        console.log('Added active to content:', tabName);
      }
      
      // è¨­ç½®é¸ä¸­åˆ†é æŒ‰éˆ•çš„ active ç‹€æ…‹
      let targetButton = null;
      if (event && event.target) {
        // æ‰¾åˆ°å¯¦éš›çš„æŒ‰éˆ•å…ƒç´ ï¼Œç„¡è«–é»æ“Šçš„æ˜¯æŒ‰éˆ•æœ¬èº«é‚„æ˜¯å…¶å­å…ƒç´ 
        targetButton = event.target.closest('.nav-button');
        console.log('Using event.target:', event.target);
        console.log('Found closest button:', targetButton);
      } else {
        // å¦‚æœæ²’æœ‰äº‹ä»¶åƒæ•¸ï¼Œæ ¹æ“š tabName æ‰¾åˆ°å°æ‡‰æŒ‰éˆ•
        targetButton = document.querySelector(`[onclick*="${tabName}"]`);
        console.log('Found button by selector:', targetButton);
      }
      
      if (targetButton) {
        targetButton.classList.add('active');
        console.log('Added active class to button:', targetButton);
        console.log('Button classes after:', targetButton.className);
      } else {
        console.error('Could not find target button for tab:', tabName);
      }
    }



    // ç™»å…¥åŠŸèƒ½
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const password = document.getElementById('passwordInput').value;
      
      if (password === 'yellowgirl') {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('mainContent').classList.add('show');
        // å„²å­˜ç™»å…¥ç‹€æ…‹åˆ° sessionStorage
        sessionStorage.setItem('adminLoggedIn', 'true');
      } else {
        alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼');
        document.getElementById('passwordInput').value = '';
      }
    });

    // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
    if (sessionStorage.getItem('adminLoggedIn') === 'true') {
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('mainContent').classList.add('show');
    }

    // åˆ‡æ›éœéŸ³åŠŸèƒ½
    function toggleMute() {
      fetch('/ads/toggle_mute?pw=yellowgirl')
        .then(response => {
          if (response.ok) {
            // é‡æ–°è¼‰å…¥éœéŸ³ç‹€æ…‹
            location.reload();
          } else {
            alert('âŒ åˆ‡æ›éœéŸ³å¤±æ•—');
          }
        })
        .catch(error => {
          alert('âŒ åˆ‡æ›éœéŸ³å¤±æ•—ï¼š' + error.message);
        });
    }

    // åˆ‡æ›èªéŸ³åŠŸèƒ½
    function toggleVoice() {
      fetch('/ads/toggle_voice?pw=yellowgirl')
        .then(response => {
          if (response.ok) {
            // é‡æ–°è¼‰å…¥èªéŸ³ç‹€æ…‹
            location.reload();
          } else {
            alert('âŒ åˆ‡æ›èªéŸ³å¤±æ•—');
          }
        })
        .catch(error => {
          alert('âŒ åˆ‡æ›èªéŸ³å¤±æ•—ï¼š' + error.message);
        });
    }

    // é‡æ–°æ•´ç†é¡¯ç¤ºç•«é¢
    function refreshDisplay() {
  fetch("/api/refresh")
        .then(() => alert("âœ… é¡¯ç¤ºç•«é¢å·²è¦æ±‚é‡æ–°æ•´ç†"))
        .catch(() => alert("âŒ é‡æ–°æ•´ç†å¤±æ•—"));
    }

    // é—œé–‰ Chromium ç€è¦½å™¨
    function closeChromium() {
      // iOS WebKit ç›¸å®¹æ€§è™•ç†
      let shouldClose = false;
      
      // å˜—è©¦ä½¿ç”¨ confirmï¼Œå¦‚æœå¤±æ•—å‰‡ç›´æ¥åŸ·è¡Œ
      try {
        shouldClose = confirm('ç¢ºå®šè¦é—œé–‰ Chromium ç€è¦½å™¨å—ï¼Ÿ\n\nâš ï¸ é€™å°‡æœƒé—œé–‰æ‰€æœ‰ Chromium é€²ç¨‹ï¼ŒåŒ…æ‹¬ç•¶å‰é¡¯ç¤ºçš„é é¢ã€‚');
      } catch (e) {
        // iOS WebKit å¯èƒ½ä¸æ”¯æ´ confirmï¼Œç›´æ¥åŸ·è¡Œ
        shouldClose = true;
        console.log('iOS WebKit ç›¸å®¹æ€§ï¼šconfirm ä¸å¯ç”¨ï¼Œç›´æ¥åŸ·è¡Œ');
      }
      
      if (shouldClose) {
        // ä½¿ç”¨æ›´ç›¸å®¹çš„ fetch æ–¹å¼
        const closeRequest = () => {
          // æ–¹æ³•1: ä½¿ç”¨ fetch
          if (typeof fetch !== 'undefined') {
            fetch("/api/close_chromium")
              .then(response => response.json())
              .then(data => {
                if (data.status === "success") {
                  alert(`âœ… ${data.message}`);
                } else if (data.status === "info") {
                  alert(`â„¹ï¸ ${data.message}`);
                } else {
                  alert(`âŒ ${data.message}`);
                }
              })
              .catch(error => {
                console.error('Fetch å¤±æ•—:', error);
                // å‚™ç”¨æ–¹æ³•ï¼šä½¿ç”¨ XMLHttpRequest
                fallbackRequest();
              });
          } else {
            // æ–¹æ³•2: ä½¿ç”¨ XMLHttpRequest (æ›´ç›¸å®¹)
            fallbackRequest();
          }
        };
        
        // å‚™ç”¨è«‹æ±‚æ–¹æ³•
        const fallbackRequest = () => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/api/close_chromium', true);
          xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
              try {
                const data = JSON.parse(xhr.responseText);
                if (data.status === "success") {
                  alert(`âœ… ${data.message}`);
                } else if (data.status === "info") {
                  alert(`â„¹ï¸ ${data.message}`);
                } else {
                  alert(`âŒ ${data.message}`);
                }
              } catch (e) {
                alert("âŒ é—œé–‰ Chromium å¤±æ•—ï¼šå›æ‡‰æ ¼å¼éŒ¯èª¤");
              }
            }
          };
          xhr.onerror = function() {
            alert("âŒ é—œé–‰ Chromium å¤±æ•—ï¼šç¶²è·¯éŒ¯èª¤");
          };
          xhr.send();
        };
        
        closeRequest();
      }
    }

    // ä¿å­˜ä¼ºæœå™¨ç¶²å€
    function saveServerUrl() {
      const serverUrl = document.getElementById('serverUrlInput').value.trim();
      if (!serverUrl) {
        alert('âŒ ä¼ºæœå™¨ç¶²å€ä¸èƒ½ç‚ºç©º');
        return;
      }
      
      if (serverUrl === '{{ server_url }}') {
        alert('âœ… ä¼ºæœå™¨ç¶²å€æœªè®Šæ›´ï¼Œç„¡éœ€é‡è¤‡ä¿å­˜ã€‚');
        return;
      }

      const saveBtn = document.querySelector('[onclick="saveServerUrl()"]');
      const originalText = saveBtn.innerHTML;
      
      // ç«‹å³æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
      saveBtn.innerHTML = 'âœ… å·²ä¿å­˜';
      saveBtn.classList.add('saved');
      saveBtn.disabled = true;

      if (confirm('ç¢ºå®šè¦ä¿å­˜ä¼ºæœå™¨ç¶²å€å—ï¼Ÿ')) {
        fetch(`/api/save_server_url?pw=yellowgirl`, {
          method: "POST",
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({server_url: serverUrl})
        })
        .then(r => r.json())
        .then(data => {
          if (data.ok) {
            // ä¿æŒå·²ä¿å­˜ç‹€æ…‹
            setTimeout(() => {
              saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜';
              saveBtn.classList.remove('saved');
              saveBtn.disabled = false;
            }, 3000); // 3ç§’å¾Œæ¢å¾©åŸç‹€
          } else {
            alert(`âŒ ${data.error}`);
            // æ¢å¾©åŸç‹€
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('saved');
            saveBtn.disabled = false;
          }
        })
        .catch(error => {
          alert(`âŒ ä¿å­˜å¤±æ•—ï¼š${error.message}`);
          // æ¢å¾©åŸç‹€
          saveBtn.innerHTML = originalText;
          saveBtn.classList.remove('saved');
          saveBtn.disabled = false;
        });
      } else {
        // ç”¨æˆ¶å–æ¶ˆï¼Œæ¢å¾©åŸç‹€
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('saved');
        saveBtn.disabled = false;
      }
    }

    // ä¿å­˜ QR Code ç¶²å€æ¨¡æ¿
    function saveQrUrl() {
      const qrUrl = document.getElementById('qrUrlInput').value.trim();
      if (!qrUrl) {
        alert('âŒ QR Code ç¶²å€æ¨¡æ¿ä¸èƒ½ç‚ºç©º');
        return;
      }
      
      if (qrUrl === '{{ qr_url }}') {
        alert('âœ… QR Code ç¶²å€æ¨¡æ¿æœªè®Šæ›´ï¼Œç„¡éœ€é‡è¤‡ä¿å­˜ã€‚');
        return;
      }

      const saveBtn = document.querySelector('[onclick="saveQrUrl()"]');
      const originalText = saveBtn.innerHTML;
      
      // ç«‹å³æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
      saveBtn.innerHTML = 'âœ… å·²ä¿å­˜';
      saveBtn.classList.add('saved');
      saveBtn.disabled = true;

      if (confirm('ç¢ºå®šè¦ä¿å­˜ QR Code ç¶²å€æ¨¡æ¿å—ï¼Ÿ')) {
        fetch(`/api/save_qr_url?pw=yellowgirl&qr_url=${encodeURIComponent(qrUrl)}`, {method: "POST"})
          .then(r => r.json())
          .then(data => {
            if (data.ok) {
              // ä¿æŒå·²ä¿å­˜ç‹€æ…‹
              setTimeout(() => {
                saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜';
                saveBtn.classList.remove('saved');
                saveBtn.disabled = false;
              }, 3000); // 3ç§’å¾Œæ¢å¾©åŸç‹€
            } else {
              alert(`âŒ ${data.error}`);
              // æ¢å¾©åŸç‹€
              saveBtn.innerHTML = originalText;
              saveBtn.classList.remove('saved');
              saveBtn.disabled = false;
            }
          })
          .catch(error => {
            alert(`âŒ ä¿å­˜å¤±æ•—ï¼š${error.message}`);
            // æ¢å¾©åŸç‹€
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('saved');
            saveBtn.disabled = false;
          });
      } else {
        // ç”¨æˆ¶å–æ¶ˆï¼Œæ¢å¾©åŸç‹€
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('saved');
        saveBtn.disabled = false;
      }
    }

    // ä¿å­˜å°è¡¨æ©Ÿ IP ä½å€
    function savePrinterIp() {
      const printerIp = document.getElementById('printerIpInput').value.trim();
      if (!printerIp) {
        alert('âŒ å°è¡¨æ©Ÿ IP ä½å€ä¸èƒ½ç‚ºç©º');
        return;
      }
      
      if (printerIp === '{{ printer_ip }}') {
        alert('âœ… å°è¡¨æ©Ÿ IP ä½å€æœªè®Šæ›´ï¼Œç„¡éœ€é‡è¤‡ä¿å­˜ã€‚');
        return;
      }

      const saveBtn = document.querySelector('[onclick="savePrinterIp()"]');
      const originalText = saveBtn.innerHTML;
      
      // ç«‹å³æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
      saveBtn.innerHTML = 'âœ… å·²ä¿å­˜';
      saveBtn.classList.add('saved');
      saveBtn.disabled = true;

      if (confirm('ç¢ºå®šè¦ä¿å­˜å°è¡¨æ©Ÿ IP ä½å€å—ï¼Ÿ')) {
        fetch(`/api/save_printer_ip?pw=yellowgirl&printer_ip=${encodeURIComponent(printerIp)}`, {method: "POST"})
          .then(r => r.json())
          .then(data => {
            if (data.ok) {
              // ä¿æŒå·²ä¿å­˜ç‹€æ…‹
              setTimeout(() => {
                saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜';
                saveBtn.classList.remove('saved');
                saveBtn.disabled = false;
              }, 3000); // 3ç§’å¾Œæ¢å¾©åŸç‹€
            } else {
              alert(`âŒ ${data.error}`);
              // æ¢å¾©åŸç‹€
              saveBtn.innerHTML = originalText;
              saveBtn.classList.remove('saved');
              saveBtn.disabled = false;
            }
          })
          .catch(error => {
            alert(`âŒ ä¿å­˜å¤±æ•—ï¼š${error.message}`);
            // æ¢å¾©åŸç‹€
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('saved');
            saveBtn.disabled = false;
          });
      } else {
        // ç”¨æˆ¶å–æ¶ˆï¼Œæ¢å¾©åŸç‹€
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('saved');
        saveBtn.disabled = false;
      }
    }

    // ä¿å­˜é è¨­åˆ—å°å¼µæ•¸
    function savePrintCount() {
      const printCount = document.getElementById('printCountInput').value;
      console.log('æº–å‚™ä¿å­˜åˆ—å°å¼µæ•¸:', printCount);
      
      if (printCount === '{{ print_count }}') {
        alert('âœ… é è¨­åˆ—å°å¼µæ•¸æœªè®Šæ›´ï¼Œç„¡éœ€é‡è¤‡ä¿å­˜ã€‚');
        return;
      }

      const count = parseInt(printCount);
      if (isNaN(count) || count < 1 || count > 10) {
        alert('âŒ è«‹è¼¸å…¥ 1-10 ä¹‹é–“çš„æ•¸å­—');
        return;
      }

      console.log('é©—è­‰é€šéï¼Œæº–å‚™ç™¼é€è«‹æ±‚ï¼Œåˆ—å°å¼µæ•¸:', count);

      const saveBtn = document.querySelector('[onclick="savePrintCount()"]');
      const originalText = saveBtn.innerHTML;
      
      // ç«‹å³æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
      saveBtn.innerHTML = 'âœ… å·²ä¿å­˜';
      saveBtn.classList.add('saved');
      saveBtn.disabled = true;

      if (confirm('ç¢ºå®šè¦ä¿å­˜é è¨­åˆ—å°å¼µæ•¸å—ï¼Ÿ')) {
        const url = `/api/save_print_count?pw=yellowgirl&print_count=${count}`;
        console.log('ç™¼é€è«‹æ±‚åˆ°:', url);
        
        fetch(url, {method: "POST"})
          .then(r => {
            console.log('æ”¶åˆ°éŸ¿æ‡‰:', r);
            return r.json();
          })
          .then(data => {
            console.log('éŸ¿æ‡‰æ•¸æ“š:', data);
            if (data.ok) {
              // ä¿æŒå·²ä¿å­˜ç‹€æ…‹
              setTimeout(() => {
                saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜';
                saveBtn.classList.remove('saved');
                saveBtn.disabled = false;
              }, 3000); // 3ç§’å¾Œæ¢å¾©åŸç‹€
            } else {
              alert(`âŒ ${data.error}`);
              // æ¢å¾©åŸç‹€
              saveBtn.innerHTML = originalText;
              saveBtn.classList.remove('saved');
              saveBtn.disabled = false;
            }
          })
          .catch(error => {
            console.error('è«‹æ±‚å¤±æ•—:', error);
            alert(`âŒ ä¿å­˜å¤±æ•—ï¼š${error.message}`);
            // æ¢å¾©åŸç‹€
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('saved');
            saveBtn.disabled = false;
          });
      } else {
        // ç”¨æˆ¶å–æ¶ˆï¼Œæ¢å¾©åŸç‹€
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('saved');
        saveBtn.disabled = false;
      }
    }

    // ä¿å­˜ç¥¨é¢èƒŒæ™¯åœ–ç‰‡
    function savePrintBg() {
      const fileInput = document.getElementById('printBgInput');
      const file = fileInput.files[0];

      if (!file) {
        alert('âŒ è«‹é¸æ“‡ä¸€å€‹åœ–ç‰‡æª”æ¡ˆ');
        return;
      }

      if (file.size > 10 * 1024 * 1024) { // 10MB é™åˆ¶
        alert('âŒ åœ–ç‰‡æª”æ¡ˆå¤ªå¤§ï¼Œè«‹é¸æ“‡å°æ–¼ 10MB çš„æª”æ¡ˆ');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      const saveBtn = document.querySelector('[onclick="savePrintBg()"]');
      const originalText = saveBtn.innerHTML;
      
      // ç«‹å³æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
      saveBtn.innerHTML = 'âœ… å·²ä¿å­˜';
      saveBtn.classList.add('saved');
      saveBtn.disabled = true;

      if (confirm('ç¢ºå®šè¦ä¸Šå‚³ç¥¨é¢èƒŒæ™¯åœ–ç‰‡å—ï¼Ÿ')) {
        fetch('/api/upload_print_bg?pw=yellowgirl', {
          method: 'POST',
          body: formData
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            // ä¿æŒå·²ä¿å­˜ç‹€æ…‹
            setTimeout(() => {
              saveBtn.innerHTML = 'ğŸ’¾ ä¸Šå‚³';
              saveBtn.classList.remove('saved');
              saveBtn.disabled = false;
            }, 3000); // 3ç§’å¾Œæ¢å¾©åŸç‹€
          } else {
            alert(`âŒ ${data.message}`);
            // æ¢å¾©åŸç‹€
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove('saved');
            saveBtn.disabled = false;
          }
        })
        .catch(error => {
          alert(`âŒ ä¸Šå‚³å¤±æ•—ï¼š${error.message}`);
          // æ¢å¾©åŸç‹€
          saveBtn.innerHTML = originalText;
          saveBtn.classList.remove('saved');
          saveBtn.disabled = false;
        });
      } else {
        // ç”¨æˆ¶å–æ¶ˆï¼Œæ¢å¾©åŸç‹€
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('saved');
        saveBtn.disabled = false;
      }
    }

    // æ¸¬è©¦åˆ—å°
    function testPrint() {
      // å½ˆå‡ºè¼¸å…¥æ¡†è®“ä½¿ç”¨è€…é¸æ“‡åˆ—å°å¼µæ•¸
      const count = prompt("è«‹è¼¸å…¥è¦åˆ—å°çš„å¼µæ•¸ (1-10):", "{{ print_count }}");
      if (count === null) return; // ä½¿ç”¨è€…å–æ¶ˆ
      
      const printCount = parseInt(count);
      if (isNaN(printCount) || printCount < 1 || printCount > 10) {
        alert("âŒ è«‹è¼¸å…¥ 1-10 ä¹‹é–“çš„æ•¸å­—");
        return;
      }
      
      fetch(`/api/print_test?pw=yellowgirl&count=${printCount}`, {method: "POST"})
        .then(r => r.json())
        .then(data => alert(`âœ… å·²é€å‡ºæ¸¬è©¦åˆ—å° x${data.printed_count}å¼µ`))
        .catch(() => alert("âŒ æ¸¬è©¦åˆ—å°å¤±æ•—"));
    }
  </script>
</body>
</html>